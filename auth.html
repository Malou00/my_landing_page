<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Firebase Email Action Handler</title>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    .hidden { display: none; }
    .success { color: green; }
    .error { color: red; }
    .info { color: #333; }
  </style>
</head>
<body>
  <h2>Processing your request...</h2>
  <div id="message"></div>

  <div id="reset-password-form" class="hidden">
    <h3>Reset Your Password</h3>
    <input type="password" id="new-password" placeholder="Enter new password" />
    <button onclick="resetPassword()">Submit</button>
  </div>

  <script>
    // ✅ Your Firebase configuration (Replace with your actual config)
    const firebaseConfig = {
        apiKey: "AIzaSyDSByG-hmcsw1TIBqitT0V3h0ZW7CJW-wg",
        authDomain: "bants-6b5d9.firebaseapp.com",
        projectId: "bants-6b5d9",
       storageBucket: "bants-6b5d9.firebasestorage.app",
       messagingSenderId: "719824578936",
      appId: "1:719824578936:web:878d28649848944c0cc08d",
       measurementId: "G-YRYHFSR0LQ"
      // Add other required fields if needed
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // ✅ Get URL parameters
    const params = new URLSearchParams(window.location.search);
    const mode = params.get('mode');
    const oobCode = params.get('oobCode');
    const messageDiv = document.getElementById('message');

    // ✅ Helper to show messages
    function showMessage(text, type = 'info') {
      messageDiv.innerHTML = `<p class="${type}">${text}</p>`;
    }

    // ✅ Reset password handler
    function resetPassword() {
      const newPassword = document.getElementById('new-password').value;
      if (!newPassword || newPassword.length < 6) {
        alert('Please enter a password with at least 6 characters.');
        return;
      }

      auth.confirmPasswordReset(oobCode, newPassword)
        .then(() => {
          showMessage('✅ Password has been reset successfully.', 'success');
        })
        .catch(error => {
          showMessage('❌ Error resetting password: ' + error.message, 'error');
        });
    }

    // ✅ Main handler for modes
    switch (mode) {
      case 'verifyEmail':
        auth.applyActionCode(oobCode)
          .then(() => {
            showMessage('✅ Email verified successfully!', 'success');
          })
          .catch(error => {
            showMessage('❌ Error verifying email: ' + error.message, 'error');
          });
        break;

      case 'resetPassword':
        document.getElementById('reset-password-form').classList.remove('hidden');
        break;

      default:
        showMessage('❌ Invalid or unsupported action.', 'error');
    }
  </script>
</body>
</html>
